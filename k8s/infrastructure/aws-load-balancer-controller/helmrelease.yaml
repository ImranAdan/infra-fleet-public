---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: aws-load-balancer-controller
  namespace: kube-system
spec:
  interval: 10m
  chart:
    spec:
      chart: aws-load-balancer-controller
      version: 1.7.1
      sourceRef:
        kind: HelmRepository
        name: eks-charts
        namespace: flux-system
      interval: 1h
  values:
    # Parameterized values injected by Flux from terraform-outputs ConfigMap
    # See infrastructure/staging/outputs-configmap.tf for value definitions
    clusterName: ${CLUSTER_NAME}

    # ServiceAccount configuration
    serviceAccount:
      create: true
      name: aws-load-balancer-controller
      # IAM role is managed by Terraform and associated via EKS Pod Identity

    # VPC and region configuration
    # These values are dynamically injected on every cluster rebuild
    region: ${AWS_REGION}
    vpcId: ${VPC_ID}

    # Single replica for pod capacity (t3.large = 35 pods max)
    # Running 1 replica is acceptable for dev/staging with nightly rebuild
    replicaCount: 1

    # Resource limits
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 200m
        memory: 256Mi

    # Enable logging
    enableShield: false
    enableWaf: false
    enableWafv2: false
